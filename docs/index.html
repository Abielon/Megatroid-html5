<!DOCTYPE html>

<!--
     HTML code used with Epic Games HTML5 projects

     much of this is for UE4 development purposes.

     to create a custom HTML file for your project:
     - make a copy of this file - or make one from scratch
     - and put it in: "your project folder"/Build/HTML/GameX.html.template
-->

<html lang="en">
<head>
	<title>Megatroid</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script> -->
	<!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> -->
	<!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet"> -->

	<script src="jquery-2.1.3.min.js"></script>
	<script src="bootstrap.min.js"></script>
	<link href="bootstrap.min.css" rel="stylesheet">

	<!-- https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.woff2 -->
	<!-- https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.woff -->
	<!-- https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/fonts/glyphicons-halflings-regular.ttf -->

	<link href="Megatroid-HTML5-Shipping.css" rel="stylesheet">
</head>
<body>

<div class="wrapper" id="mainarea">
	<div class="alert alert-warning centered-axis-xy" style="min-height: 20px; display:none;" role="alert" id="compilingmessage">
		<div id='loadTasks'> </div>
	</div>
	<!-- The "tabindex=0" specifier on the canvas is important to allow it to capture keyboard focus when clicking on it with a mouse -->
	<canvas tabindex=0 id="canvas" class="emscripten" oncontextmenu="event.preventDefault()" style="display:none;">
</div>
<div class="buttonarea text-center" id="buttonarea">
	<!--
	<button type="button" class="btn btn-primary" id="exit_pointerlock" title="Exit Pointerlock" style="display:none">
		<span class="glyphicon glyphicon-hand-up" aria-hidden="true"></span>
		<span class="buttontext">&nbsp;Exit Pointerlock</span>
	</button>
	-->
	
	<button type="button" class="btn btn-primary" id="about" data-toggle="modal" data-target="#aboutModal" title="$Abielon">
		<span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
		<span class="buttontext">&nbsp;$Abielon</span>
	</button>
	
	
	<button type="button" id="pause" class="btn btn-primary" onclick="try { Module['pauseMainLoop'](); $('#resume').show().focus(); $('#pause').hide(); } catch(e) {console.error(e);}" title="Pause" style="display:none">
		<span class="glyphicon glyphicon-pause" aria-hidden="true"></span>
		<span class="buttontext">&nbsp;Pause</span> 
	</button>
	<button type="button" id="resume" class="btn btn-primary" onclick="try { Module['resumeMainLoop'](); $('#pause').show().focus(); $('#resume').hide(); } catch(e) {console.error(e);}" title="Resume" style="display:none">
		<span class="glyphicon glyphicon-play" aria-hidden="true"></span>
		<span class="buttontext">&nbsp;Resume</span>
	</button>
	
	<!--<button type="button" class="btn btn-primary" onclick="var w = document.getElementById('logwindow'); w.style.display = w.style.display ? '' : 'none';">Toggle Log</button></div>-->
	
	<button type="button" class="btn btn-primary" id="clear_indexeddb" onclick="try { deleteIndexedDBStorage(); } catch(e) {console.error(e);}" title="Clear IndexedDB" style="display:none">
		<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
		<span class="buttontext">&nbsp;Clear IndexedDB</span>
	</button>
	
	
	<button type="button" class="btn btn-primary" id="fullscreen_request" title="Fullscreen" style="display:none">
		<span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
		<span class="buttontext">&nbsp;Fullscreen</span>
	</button>
	
	<script>
(function(){
  const fsBtn = document.getElementById('fullscreen_request');
  const target = document.getElementById('canvas') || document.getElementById('mainarea') || document.documentElement;

  async function requestFSAndLock() {
    try {
      // Request fullscreen directly from the user gesture
      if (target.requestFullscreen) {
        await target.requestFullscreen();
      } else if (target.webkitRequestFullscreen) {
        await target.webkitRequestFullscreen();
      } else if (target.msRequestFullscreen) {
        await target.msRequestFullscreen();
      } else {
        console.warn('No fullscreen API available');
        return;
      }
      // Now wait for fullscreenchange event to fire — lock will be attempted there
    } catch (err) {
      console.warn('requestFullscreen failed', err);
    }
  }

  async function tryLockLandscape() {
    try {
      if (screen.orientation && screen.orientation.lock) {
        // Try strongest explicit lock first
        await screen.orientation.lock('landscape-primary');
        console.log('Orientation locked to landscape-primary');
        return true;
      } else if (screen.lockOrientation || screen.mozLockOrientation || screen.msLockOrientation) {
        const lockFn = screen.lockOrientation || screen.mozLockOrientation || screen.msLockOrientation;
        lockFn.call(screen, 'landscape');
        console.log('Orientation locked (legacy API)');
        return true;
      } else {
        console.warn('Orientation lock not supported');
      }
    } catch (err) {
      console.warn('Orientation lock failed', err);
    }
    return false;
  }

  // Fullscreen change handler: called when fullscreen state actually changes
  async function onFullscreenChange() {
    const isFs = !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement);
    if (isFs) {
      const locked = await tryLockLandscape();
      if (!locked) {
        // fallback for platforms that won't lock (iOS): apply CSS rotate
        document.documentElement.classList.add('force-landscape-fallback');
      } else {
        document.documentElement.classList.remove('force-landscape-fallback');
      }
    } else {
      // Exited fullscreen — unlock and cleanup
      if (screen.orientation && screen.orientation.unlock) {
        try { screen.orientation.unlock(); } catch(e) {}
      }
      document.documentElement.classList.remove('force-landscape-fallback');
    }
  }

  // Hook events
  fsBtn.addEventListener('click', requestFSAndLock, false);
  document.addEventListener('fullscreenchange', onFullscreenChange);
  document.addEventListener('webkitfullscreenchange', onFullscreenChange);
  document.addEventListener('msfullscreenchange', onFullscreenChange);

  // Optional: allow pressing the canvas to trigger fullscreen on mobile if the button is hidden
  // canvas.addEventListener('click', requestFSAndLock);
})();
</script>

	
	<script>
const fullBtn = document.getElementById('fullscreen_request');
const target = document.documentElement; // or a specific container element

async function enterFullscreenAndLockLandscape() {
  try {
    // Request fullscreen
    if (target.requestFullscreen) {
      await target.requestFullscreen();
    } else if (target.webkitRequestFullscreen) {
      await target.webkitRequestFullscreen(); // Safari older prefix
    } else if (target.msRequestFullscreen) {
      await target.msRequestFullscreen();
    }

    // Try to lock orientation to landscape
    if (screen.orientation && screen.orientation.lock) {
      await screen.orientation.lock('landscape');
    } else if (screen.lockOrientation || screen.mozLockOrientation || screen.msLockOrientation) {
      // older vendor methods
      const lockFn = screen.lockOrientation || screen.mozLockOrientation || screen.msLockOrientation;
      lockFn.call(screen, 'landscape');
    } else {
      // No orientation lock support — CSS fallback handled elsewhere
      console.warn('Orientation lock not available; applying visual fallback.');
      applyCssLandscapeFallback();
    }
  } catch (err) {
    console.warn('Fullscreen/orientation lock failed:', err);
    // If orientation lock fails but we're in fullscreen, still apply fallback
    if (document.fullscreenElement || document.webkitIsFullScreen) {
      applyCssLandscapeFallback();
    }
  }
}

function applyCssLandscapeFallback() {
  // Add a class to your root/container to rotate content 90deg and center it.
  // Use only when orientation lock is not available (e.g., iOS Safari).
  document.documentElement.classList.add('force-landscape-fallback');
}

fullBtn.addEventListener('click', enterFullscreenAndLockLandscape);
</script>
	
</div>


<div class="modal fade" id="aboutModal" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-body">
				<div>Cash app as gift please, anything helps. -Your noble paladin Abielon @Keyless Abyss</div>
				<div class="text-center">
					<button type="button" class="btn btn-default" data-dismiss="modal" style="margin-bottom:0">
						<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
						<span class="buttontext">&nbsp;Close</span>
					</button>
				</div>
			</div>
		</div>
	</div>
</div>


<div class="texthalf text-normal jumbotron " id="logwindow" style='display:none'></div>

<script src="Megatroid-HTML5-Shipping.UE4.js"></script>
</body>
</html>
